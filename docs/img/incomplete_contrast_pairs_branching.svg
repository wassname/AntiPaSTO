<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 320">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#6b7280"/>
    </marker>
    <marker id="arrow-light" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#cbd5e1"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="900" height="320" fill="#ffffff"/>

  <!-- Title -->
  <text x="450" y="26" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="650" fill="#111827">
    Incomplete contrast pairs (prefix-only)
  </text>

  <!-- Left: two incomplete prefixes -->
  <g transform="translate(24, 62)">
    <!-- chosen prefix -->
    <rect x="0" y="0" width="360" height="66" rx="8" fill="#ffffff" stroke="#e5e7eb" stroke-width="1.5"/>
    <rect x="0" y="0" width="8" height="66" rx="8" fill="#16a34a"/>
    <text x="18" y="22" font-family="system-ui, sans-serif" font-size="11" font-weight="650" fill="#111827">chosen prefix</text>
    <text x="18" y="44" font-family="monospace" font-size="11" fill="#111827">You are</text>
    <text x="78" y="44" font-family="monospace" font-size="11" font-weight="650" fill="#166534">honest</text>
    <text x="120" y="44" font-family="monospace" font-size="11" fill="#111827">. The capital of France is</text>

    <!-- rejected prefix -->
    <rect x="0" y="92" width="360" height="66" rx="8" fill="#ffffff" stroke="#e5e7eb" stroke-width="1.5"/>
    <rect x="0" y="92" width="8" height="66" rx="8" fill="#db2777"/>
    <text x="18" y="114" font-family="system-ui, sans-serif" font-size="11" font-weight="650" fill="#111827">rejected prefix</text>
    <text x="18" y="136" font-family="monospace" font-size="11" fill="#111827">You are</text>
    <text x="78" y="136" font-family="monospace" font-size="11" font-weight="650" fill="#9d174d">dishonest</text>
    <text x="140" y="136" font-family="monospace" font-size="11" fill="#111827">. The capital of France is</text>

    <!-- note: incomplete -->
    <text x="0" y="190" font-family="system-ui, sans-serif" font-size="10" fill="#6b7280">
      Incomplete: prefixes end before any response tokens are generated.
    </text>
  </g>

  <!-- Arrows to hidden states -->
  <path d="M 390 95 L 450 95" stroke="#6b7280" stroke-width="1.8" marker-end="url(#arrow)"/>
  <path d="M 390 187 L 450 187" stroke="#6b7280" stroke-width="1.8" marker-end="url(#arrow)"/>

  <!-- Middle: h_cho / h_rej -->
  <g transform="translate(470, 72)">
    <!-- h_cho -->
    <rect x="0" y="0" width="78" height="46" rx="8" fill="#f9fafb" stroke="#9ca3af" stroke-width="1.5"/>
    <rect x="0" y="38" width="78" height="8" rx="0" fill="#16a34a"/>
    <text x="39" y="28" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" fill="#111827">h_cho</text>

    <!-- h_rej -->
    <rect x="0" y="92" width="78" height="46" rx="8" fill="#f9fafb" stroke="#9ca3af" stroke-width="1.5"/>
    <rect x="0" y="130" width="78" height="8" rx="0" fill="#db2777"/>
    <text x="39" y="120" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" fill="#111827">h_rej</text>

    <!-- similarity annotation -->
    <text x="39" y="156" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#6b7280">~95% shared</text>
  </g>

  <!-- Δh extraction -->
  <path d="M 548 95 L 585 141" stroke="#d97706" stroke-width="2"/>
  <path d="M 548 187 L 585 141" stroke="#d97706" stroke-width="2"/>

  <g transform="translate(595, 118)">
    <rect x="0" y="0" width="92" height="46" rx="10" fill="#fef3c7" stroke="#d97706" stroke-width="2"/>
    <text x="46" y="20" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="700" fill="#92400e">Δh</text>
    <text x="46" y="36" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" font-weight="650" fill="#92400e">= h_cho − h_rej</text>
  </g>

  <!-- Training vs eval callouts -->
  <g transform="translate(24, 256)">
    <rect x="0" y="0" width="410" height="44" rx="10" fill="#fef3c7" stroke="#d97706" stroke-width="1.5"/>
    <text x="205" y="18" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="650" fill="#92400e">Training signal (self-supervised)</text>
    <text x="205" y="34" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#92400e">Δh is the only difference → branch-selecting info must be encoded in Δh.</text>
  </g>

  <!-- Right: eval-only diverging trajectories inset (map fork) -->
  <path d="M 690 141 L 730 141" stroke="#cbd5e1" stroke-width="1.6" stroke-dasharray="4,3" marker-end="url(#arrow-light)"/>
  <text x="710" y="132" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#9ca3af" font-style="italic">eval only</text>

  <g transform="translate(740, 88)">
    <rect x="0" y="0" width="150" height="110" rx="10" fill="none" stroke="#9ca3af" stroke-width="1.5" stroke-dasharray="4,3"/>
    <rect x="10" y="10" width="130" height="90" rx="8" fill="#f9fafb" stroke="#e5e7eb"/>

    <!-- subtle roads -->
    <path d="M 18 28 L 72 28 L 132 28" stroke="#e5e7eb" stroke-width="1"/>
    <path d="M 18 82 L 72 82 L 132 82" stroke="#e5e7eb" stroke-width="1"/>
    <path d="M 38 18 L 38 92" stroke="#e5e7eb" stroke-width="1"/>
    <path d="M 110 18 L 110 92" stroke="#e5e7eb" stroke-width="1"/>

    <!-- start and fork -->
    <circle cx="28" cy="55" r="3" fill="#6b7280"/>
    <circle cx="70" cy="55" r="3" fill="#d97706"/>
    <text x="70" y="45" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#92400e">Δh</text>

    <!-- two possible continuations -->
    <path d="M 28 55 C 42 55, 56 55, 70 55" stroke="#9ca3af" stroke-width="2" fill="none" stroke-linecap="round"/>
    <path d="M 70 55 C 92 40, 112 30, 128 24" stroke="#16a34a" stroke-width="2.6" fill="none" stroke-linecap="round"/>
    <path d="M 70 55 C 92 70, 112 80, 128 86" stroke="#db2777" stroke-width="2.6" fill="none" stroke-linecap="round"/>

    <!-- endpoints -->
    <circle cx="128" cy="24" r="3" fill="#16a34a"/>
    <circle cx="128" cy="86" r="3" fill="#db2777"/>

    <text x="128" y="20" text-anchor="end" font-family="monospace" font-size="9" fill="#16a34a">Paris</text>
    <text x="128" y="104" text-anchor="end" font-family="monospace" font-size="9" fill="#db2777">Berlin</text>
  </g>

  <!-- Legend -->
  <g transform="translate(470, 252)">
    <rect x="0" y="0" width="8" height="8" fill="#16a34a"/>
    <text x="14" y="8" font-family="system-ui, sans-serif" font-size="10" fill="#374151">chosen</text>
    <rect x="90" y="0" width="8" height="8" fill="#db2777"/>
    <text x="104" y="8" font-family="system-ui, sans-serif" font-size="10" fill="#374151">rejected</text>
    <rect x="190" y="0" width="8" height="8" fill="none" stroke="#9ca3af" stroke-width="1.2" stroke-dasharray="2,2"/>
    <text x="204" y="8" font-family="system-ui, sans-serif" font-size="10" fill="#9ca3af">eval only</text>
  </g>
</svg>
